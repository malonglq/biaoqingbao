<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DIYåˆ›æ„è¡¨æƒ…åŒ…</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* å…¨æ–°é…è‰²æ–¹æ¡ˆå˜é‡å®šä¹‰ */
        :root {
            /* ä¸»è‰²è°ƒ */
            --primary-color: #FF6B6B;
            --primary-hover: #FF5252;
            --primary-active: #E53E3E;

            /* æ¬¡è¦è‰²è°ƒ */
            --secondary-color: #FFE66D;
            --secondary-hover: #FFD93D;
            --secondary-active: #FFC107;

            /* å¼ºè°ƒè‰² */
            --accent-color: #9C88FF;
            --accent-hover: #8B7CF6;
            --accent-active: #7C3AED;

            /* æ–‡å­—é¢œè‰² */
            --text-primary: #2D3748;
            --text-secondary: #4A5568;
            --text-hint: #718096;
            --text-inverse: #FFFFFF;
            --text-link: #3182CE;

            /* çŠ¶æ€è‰² */
            --success-color: #48BB78;
            --warning-color: #ED8936;
            --error-color: #F56565;
            --info-color: #4299E1;

            /* èƒŒæ™¯è‰² */
            --card-bg: #FFFFFF;
            --container-secondary: #F7FAFC;
            --input-bg: #FFFFFF;
            --input-border: #E2E8F0;
            --divider-color: #E2E8F0;

            /* é€‰ä¸­çŠ¶æ€ */
            --selected-bg: rgba(255, 107, 107, 0.1);
            --hover-overlay: rgba(255, 255, 255, 0.1);
            --active-overlay: rgba(0, 0, 0, 0.1);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #FF6B6B 0%, #FFE66D 50%, #FF8E53 100%);
            height: 100vh;
            overflow: hidden;
            position: relative;
        }

        .container {
            width: 375px;
            height: 812px;
            margin: 0 auto;
            background: linear-gradient(135deg, #00C851 0%, #00FF7F 100%);
            position: relative;
            overflow: hidden;
        }

        /* çŠ¶æ€æ  */
        .status-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 20px;
            color: white;
            font-size: 14px;
            font-weight: 600;
        }

        .status-left {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .status-right {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        /* æ ‡é¢˜æ  */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 20px;
            color: white;
        }

        .title {
            font-size: 18px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .header-icons {
            display: flex;
            gap: 15px;
        }

        .icon {
            width: 24px;
            height: 24px;
            background: rgba(255,255,255,0.3);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }

        /* é¢„è§ˆåŒºåŸŸ */
        .preview-area {
            margin: 20px;
            background: white;
            border-radius: 12px;
            height: 280px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            position: relative;
            overflow: hidden;
        }

        .preview-content {
            text-align: center;
            color: #999;
            line-height: 1.6;
            position: relative;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* å›¾å±‚å…ƒç´ æ ·å¼ */
        .preview-layer {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            display: flex;
            align-items: center;
            justify-content: center;
            pointer-events: none;
        }

        .body-layer {
            z-index: 1;
            font-size: 48px;
        }

        .expression-layer {
            z-index: 2;
            font-size: 48px;
        }

        .text-layer {
            z-index: 3;
            font-size: 18px;
            font-weight: 600;
            text-align: center;
            white-space: pre-wrap;
            max-width: 200px;
        }

        .default-hint {
            z-index: 0;
            color: #999;
            line-height: 1.6;
        }

        .preview-image {
            width: 150px;
            height: 150px;
            background: #f0f0f0;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 20px;
        }

        /* åŠŸèƒ½æ ‡ç­¾æ  */
        .tab-bar {
            display: flex;
            padding: 0 20px;
            margin-bottom: 10px;
        }

        .tab-item {
            flex: 1;
            text-align: center;
            padding: 12px 0;
            color: rgba(255,255,255,0.7);
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            border-radius: 8px;
            margin: 0 4px;
        }

        .tab-item:hover:not(.active) {
            color: rgba(255,255,255,0.9);
            background: var(--hover-overlay);
        }

        .tab-item.active {
            color: var(--text-inverse);
            font-weight: 600;
            background: linear-gradient(135deg, var(--accent-color), var(--primary-color));
            box-shadow: 0 2px 8px rgba(156, 136, 255, 0.3);
        }

        .tab-item.active::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 50%;
            transform: translateX(-50%);
            width: 20px;
            height: 3px;
            background: var(--secondary-color);
            border-radius: 2px;
        }

        /* å†…å®¹åŒºåŸŸ */
        .content-area {
            background: var(--container-secondary);
            border-radius: 20px 20px 0 0;
            flex: 1;
            padding: 20px 20px 80px 20px; /* å¢åŠ åº•éƒ¨paddingé¿å…è¢«å¯¼èˆªæ é®æŒ¡ */
            overflow-y: auto;
            margin-bottom: 0;
        }

        /* åˆ†ç±»æ ‡ç­¾ */
        .category-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            overflow-x: auto;
            padding-bottom: 5px;
        }

        .category-tab {
            padding: 10px 18px;
            background: var(--card-bg);
            border-radius: 25px;
            font-size: 13px;
            color: var(--text-secondary);
            cursor: pointer;
            white-space: nowrap;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            font-weight: 500;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        }

        .category-tab:hover:not(.active) {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.12);
            color: var(--text-primary);
        }

        .category-tab.active {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: var(--text-inverse);
            border-color: transparent;
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(255, 107, 107, 0.3);
        }

        /* ç´ æç½‘æ ¼ */
        .material-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
        }

        .material-item {
            aspect-ratio: 1;
            background: var(--card-bg);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            position: relative;
            overflow: hidden;
        }

        .material-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, transparent, rgba(255, 255, 255, 0.1));
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .material-item:hover {
            transform: scale(1.05) translateY(-2px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
        }

        .material-item:hover::before {
            opacity: 1;
        }

        .material-item.selected {
            border: 3px solid;
            border-image: linear-gradient(135deg, var(--primary-color), var(--accent-color), var(--secondary-color)) 1;
            transform: scale(1.02) translateY(-1px);
            box-shadow: 0 6px 16px rgba(255, 107, 107, 0.3);
        }

        .material-item.upload {
            border: 2px dashed var(--text-hint);
            color: var(--text-hint);
            font-size: 12px;
            text-align: center;
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
        }

        .material-item.upload:hover {
            border-color: var(--accent-color);
            color: var(--accent-color);
            background: linear-gradient(135deg, #f1f3f4, #e8eaed);
        }

        /* åº•éƒ¨å¯¼èˆª */
        .bottom-nav {
            display: flex;
            background: var(--card-bg);
            padding: 12px 0;
            border-top: 1px solid var(--divider-color);
            position: relative;
            z-index: 10;
            margin-top: auto;
            box-shadow: 0 -2px 12px rgba(0, 0, 0, 0.08);
        }

        .nav-item {
            flex: 1;
            text-align: center;
            padding: 8px 0;
            color: var(--text-hint);
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            border-radius: 8px;
            margin: 0 8px;
        }

        .nav-item:hover:not(.active) {
            color: var(--text-secondary);
            background: var(--container-secondary);
        }

        .nav-item.active {
            color: var(--primary-color);
            background: var(--selected-bg);
        }

        .nav-icon {
            width: 24px;
            height: 24px;
            margin: 0 auto 4px;
            background: var(--text-hint);
            border-radius: 6px;
            transition: all 0.3s ease;
        }

        .nav-item.active .nav-icon {
            background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
        }

        /* éšè—å…¶ä»–é¡µé¢å†…å®¹ */
        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* æ–‡å­—ç¼–è¾‘é¡µé¢æ ·å¼ */
        .text-input {
            width: 100%;
            padding: 16px 20px;
            border: 2px solid var(--input-border);
            border-radius: 12px;
            font-size: 16px;
            margin-bottom: 24px;
            background: var(--input-bg);
            color: var(--text-primary);
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
        }

        .text-input:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 0 3px rgba(156, 136, 255, 0.1);
        }

        .color-picker-section {
            margin-bottom: 24px;
        }

        .color-picker {
            width: 100%;
            height: 44px;
            border-radius: 22px;
            background: linear-gradient(to right, #000, #ff0000, #ffff00, #00ff00, #00ffff, #0000ff, #ff00ff, #fff);
            margin-bottom: 16px;
            position: relative;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .color-handle {
            width: 24px;
            height: 24px;
            background: var(--card-bg);
            border: 3px solid var(--text-primary);
            border-radius: 50%;
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }

        .color-handle:hover {
            transform: translateY(-50%) scale(1.1);
        }

        .toggle-section {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            color: var(--text-primary);
            font-weight: 500;
        }

        .toggle {
            width: 54px;
            height: 32px;
            background: var(--success-color);
            border-radius: 16px;
            position: relative;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(72, 187, 120, 0.3);
        }

        .toggle::after {
            content: '';
            width: 28px;
            height: 28px;
            background: var(--card-bg);
            border-radius: 50%;
            position: absolute;
            top: 2px;
            right: 2px;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .toggle.off {
            background: var(--text-hint);
            box-shadow: 0 2px 8px rgba(113, 128, 150, 0.2);
        }

        .toggle.off::after {
            right: 24px;
        }

        .text-hint {
            color: var(--text-hint);
            font-size: 13px;
            text-align: center;
            margin-top: 24px;
            line-height: 1.5;
            background: var(--card-bg);
            padding: 12px 16px;
            border-radius: 8px;
            border-left: 3px solid var(--accent-color);
        }

        /* ç”Ÿæˆé¡µé¢æ ·å¼ */
        .generate-preview {
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20"><rect width="10" height="10" fill="%23f0f0f0"/><rect x="10" y="10" width="10" height="10" fill="%23f0f0f0"/></svg>');
            border-radius: 12px;
            height: 200px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 20px;
            position: relative;
            overflow: hidden;
        }

        .generate-content {
            width: 120px;
            height: 120px;
            background: transparent;
            border-radius: 8px;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* ç”Ÿæˆé¡µé¢çš„å›¾å±‚æ ·å¼ */
        .generate-layer {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            display: flex;
            align-items: center;
            justify-content: center;
            pointer-events: none;
        }

        .generate-body-layer {
            z-index: 1;
            font-size: 48px;
        }

        .generate-expression-layer {
            z-index: 2;
            font-size: 48px;
        }

        .generate-text-layer {
            z-index: 3;
            font-size: 18px;
            font-weight: 600;
            text-align: center;
            white-space: pre-wrap;
            max-width: 100px;
        }

        .option-section {
            margin-bottom: 20px;
        }

        .option-title {
            font-size: 16px;
            margin-bottom: 16px;
            color: var(--text-primary);
            font-weight: 600;
        }

        .option-buttons {
            display: flex;
            gap: 12px;
        }

        .option-btn {
            flex: 1;
            padding: 14px 12px;
            background: var(--card-bg);
            border: 2px solid var(--input-border);
            border-radius: 12px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            color: var(--text-secondary);
            font-weight: 500;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
        }

        .option-btn:hover:not(.active) {
            border-color: var(--accent-color);
            color: var(--text-primary);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .option-btn.active {
            background: linear-gradient(135deg, var(--accent-color), var(--primary-color));
            color: var(--text-inverse);
            border-color: transparent;
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(156, 136, 255, 0.3);
        }

        .generate-btn {
            width: 100%;
            padding: 18px;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: var(--text-inverse);
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            margin-bottom: 16px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 16px rgba(255, 107, 107, 0.3);
        }

        .generate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(255, 107, 107, 0.4);
        }

        .generate-btn:active {
            transform: translateY(0);
        }

        .feedback-link {
            text-align: center;
            color: var(--text-link);
            font-size: 14px;
            cursor: pointer;
            transition: color 0.3s ease;
        }

        .feedback-link:hover {
            color: var(--primary-color);
        }

        /* è§¦æ‘¸äº¤äº’æ ·å¼ */
        .preview-layer {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.2s ease;
            cursor: pointer;
            user-select: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            touch-action: none;
        }

        .preview-layer.interactive {
            transition: none;
        }

        .preview-layer.flipping {
            transition: transform 0.3s ease;
        }

        .body-layer {
            z-index: 1;
            font-size: 48px;
        }

        .expression-layer {
            z-index: 2;
            font-size: 48px;
        }

        .text-layer {
            z-index: 3;
            font-size: 18px;
            font-weight: 600;
            text-align: center;
            white-space: pre-wrap;
            max-width: 100px;
        }

        .default-hint {
            z-index: 0;
            color: #999;
            font-size: 14px;
            text-align: center;
            pointer-events: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- çŠ¶æ€æ  -->
        <div class="status-bar">
            <div class="status-left">
                <span>19:39</span>
                <span>ğŸ”¶</span>
                <span>ğŸ“¶</span>
                <span>ğŸ“¶</span>
            </div>
            <div class="status-right">
                <span>ğŸ </span>
                <span>ğŸ”µ</span>
                <span>100%</span>
                <span>ğŸ“¶</span>
                <span>ğŸ“¶</span>
                <span>49</span>
            </div>
        </div>

        <!-- æ ‡é¢˜æ  -->
        <div class="header">
            <div class="title">
                è‡ªåˆ¶åˆ›æ„DIYè¡¨æƒ…åŒ… ğŸ“±
            </div>
            <div class="header-icons">
                <div class="icon">â‹¯</div>
                <div class="icon">â€”</div>
                <div class="icon">âŠ™</div>
            </div>
        </div>

        <!-- é¢„è§ˆåŒºåŸŸ -->
        <div class="preview-area">
            <div class="preview-content" id="previewContent">
                <!-- é»˜è®¤æç¤ºæ–‡å­— -->
                <div class="preview-layer default-hint" id="defaultHint">
                    <div>
                        <div>å•æŒ‡ï¼šæ»‘åŠ¨å…ƒç´ </div>
                        <div>åŒæŒ‡ï¼šç¼©æ”¾æ—‹è½¬</div>
                        <div>ç‚¹å‡»ï¼šæ°´å¹³ç¿»è½¬</div>
                    </div>
                </div>
                <!-- èº«ä½“å›¾å±‚ (æœ€åº•å±‚) -->
                <div class="preview-layer body-layer" id="bodyLayer" style="display: none;"></div>
                <!-- è¡¨æƒ…å›¾å±‚ (ä¸­é—´å±‚) -->
                <div class="preview-layer expression-layer" id="expressionLayer" style="display: none;"></div>
                <!-- æ–‡å­—å›¾å±‚ (æœ€é¡¶å±‚) -->
                <div class="preview-layer text-layer" id="textLayer" style="display: none;"></div>
            </div>
        </div>

        <!-- åŠŸèƒ½æ ‡ç­¾æ  -->
        <div class="tab-bar">
            <div class="tab-item active" data-tab="body">é€‰èº«ä½“</div>
            <div class="tab-item" data-tab="expression">é€‰è¡¨æƒ…</div>
            <div class="tab-item" data-tab="text">è´´æ–‡å­—</div>
            <div class="tab-item" data-tab="generate">å‘è¡¨æƒ…</div>
        </div>

        <!-- å†…å®¹åŒºåŸŸ -->
        <div class="content-area">
            <!-- é€‰èº«ä½“é¡µé¢ -->
            <div class="tab-content active" id="bodyTab">
                <div class="category-tabs">
                    <div class="category-tab active" data-category="panda">ç†ŠçŒ«</div>
                    <div class="category-tab" data-category="mushroom">è˜‘è‡å¤´</div>
                    <div class="category-tab" data-category="round">åœ†è„¸</div>
                    <div class="category-tab" data-category="rabbit">å…”å­</div>
                    <div class="category-tab" data-category="dark">é»‘æš—åŠ¿åŠ›</div>
                    <div class="category-tab" data-category="comic">æ¼«ç”»</div>
                </div>
                <div class="material-grid" id="bodyGrid">
                    <div class="material-item upload">
                        <div>+<br>ä¸Šä¼ </div>
                    </div>
                    <!-- è¡¨æƒ…ç´ æå°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                </div>
            </div>

            <!-- é€‰è¡¨æƒ…é¡µé¢ -->
            <div class="tab-content" id="expressionTab">
                <div class="category-tabs">
                    <div class="category-tab active" data-category="happy">å¼€å¿ƒ</div>
                    <div class="category-tab" data-category="sad">éš¾è¿‡</div>
                    <div class="category-tab" data-category="angry">æ„¤æ€’</div>
                    <div class="category-tab" data-category="love">çˆ±å¿ƒ</div>
                    <div class="category-tab" data-category="surprise">æƒŠè®¶</div>
                </div>
                <div class="material-grid" id="expressionGrid">
                    <div class="material-item upload">
                        <div>+<br>ä¸Šä¼ </div>
                    </div>
                    <!-- è¡¨æƒ…ç´ æå°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                </div>
            </div>

            <!-- è´´æ–‡å­—é¡µé¢ -->
            <div class="tab-content" id="textTab">
                <input type="text" class="text-input" placeholder="ç‚¹å‡»è¾“å…¥" id="textInput">

                <div class="color-picker-section">
                    <div class="color-picker" id="textColorPicker">
                        <div class="color-handle" id="textColorHandle" style="left: 10px;"></div>
                    </div>
                </div>

                <div class="toggle-section">
                    <span>æ˜¾ç¤ºæè¾¹</span>
                    <div class="toggle" id="strokeToggle">
                    </div>
                </div>

                <div class="color-picker-section">
                    <div class="color-picker" id="strokeColorPicker">
                        <div class="color-handle" id="strokeColorHandle" style="left: 10px;"></div>
                    </div>
                </div>

                <div class="text-hint">
                    ã€Œè´´æ–‡å­—ã€æ”¯æŒæ¢è¡Œï¼ŒåŒæŒ‡ç¼©æ”¾è°ƒæ•´å¤§å°å’Œæ—‹è½¬
                </div>
            </div>

            <!-- å‘è¡¨æƒ…é¡µé¢ -->
            <div class="tab-content" id="generateTab">
                <div class="generate-preview">
                    <div class="generate-content" id="generateContent">
                        <!-- èº«ä½“å›¾å±‚ (æœ€åº•å±‚) -->
                        <div class="generate-layer generate-body-layer" id="generateBodyLayer" style="display: none;"></div>
                        <!-- è¡¨æƒ…å›¾å±‚ (ä¸­é—´å±‚) -->
                        <div class="generate-layer generate-expression-layer" id="generateExpressionLayer" style="display: none;"></div>
                        <!-- æ–‡å­—å›¾å±‚ (æœ€é¡¶å±‚) -->
                        <div class="generate-layer generate-text-layer" id="generateTextLayer" style="display: none;"></div>
                    </div>
                </div>

                <div class="option-section">
                    <div class="option-title">è®¾ç½®ä¸ºé€æ˜èƒŒæ™¯</div>
                </div>

                <div class="option-section">
                    <div class="option-buttons">
                        <div class="option-btn active" data-size="small">å°å°ºå¯¸</div>
                        <div class="option-btn" data-size="medium">ä¸­å°ºå¯¸</div>
                        <div class="option-btn" data-size="large">å¤§å°ºå¯¸</div>
                    </div>
                </div>

                <div class="option-section">
                    <div class="option-buttons">
                        <div class="option-btn active" data-quality="suitable">é€‚å®œ</div>
                        <div class="option-btn" data-quality="compress">å‹ç¼©</div>
                        <div class="option-btn" data-quality="lossless">æ— æŸ</div>
                    </div>
                </div>

                <button class="generate-btn" id="generateBtn">ç”Ÿæˆ</button>

                <div class="feedback-link">é—®é¢˜åé¦ˆ</div>
            </div>
        </div>

        <!-- åº•éƒ¨å¯¼èˆª -->
        <div class="bottom-nav">
            <div class="nav-item active">
                <div class="nav-icon"></div>
                <div>åˆ¶ä½œè¡¨æƒ…</div>
            </div>
            <div class="nav-item">
                <div class="nav-icon"></div>
                <div>è¡¨æƒ…å¹¿åœº</div>
            </div>
        </div>
    </div>

    <script>
        // å…¨å±€å˜é‡
        let currentTab = 'body';
        let currentCategory = 'panda';
        let selectedBody = null;
        let selectedExpression = null;
        let textContent = '';
        let textColor = '#000000';
        let strokeEnabled = true;
        let strokeColor = '#ffffff';

        // è§¦æ‘¸äº¤äº’å˜é‡
        let layerTransforms = {
            body: { x: 0, y: 0, scale: 1, rotation: 0, flipX: false },
            expression: { x: 0, y: 0, scale: 1, rotation: 0, flipX: false },
            text: { x: 0, y: 0, scale: 1, rotation: 0, flipX: false }
        };

        let touchState = {
            isDragging: false,
            isScaling: false,
            activeLayer: null,
            startTouches: [],
            lastTouches: [],
            initialDistance: 0,
            initialAngle: 0,
            initialTransform: null
        };

        // ç´ ææ•°æ®
        const materials = {
            panda: ['ğŸ¼', 'ğŸ¾', 'ğŸ‹', 'ğŸ', 'ğŸƒ', 'ğŸŒ¿', 'ğŸŒ±', 'ğŸŒ¾', 'ğŸ„', 'ğŸŒ²', 'ğŸŒ³', 'ğŸŒ´', 'ğŸŒµ', 'ğŸŒ¶ï¸', 'ğŸ¥’'],
            mushroom: ['ğŸ„', 'ğŸŸ«', 'ğŸŸ¤', 'ğŸ¤', 'ğŸŸ ', 'ğŸŸ¡', 'ğŸŸ¢', 'ğŸ”µ', 'ğŸŸ£', 'ğŸŸ¥', 'ğŸŸ§', 'ğŸŸ¨', 'ğŸŸ©', 'ğŸŸ¦', 'ğŸŸª'],
            round: ['ğŸ˜€', 'ğŸ˜ƒ', 'ğŸ˜„', 'ğŸ˜', 'ğŸ˜†', 'ğŸ˜…', 'ğŸ˜‚', 'ğŸ¤£', 'ğŸ˜Š', 'ğŸ˜‡', 'ğŸ™‚', 'ğŸ™ƒ', 'ğŸ˜‰', 'ğŸ˜Œ', 'ğŸ˜'],
            rabbit: ['ğŸ°', 'ğŸ‡', 'ğŸ¥•', 'ğŸŒ¸', 'ğŸŒº', 'ğŸŒ»', 'ğŸŒ·', 'ğŸŒ¹', 'ğŸ’', 'ğŸŒ¼', 'ğŸŒ¾', 'ğŸ€', 'ğŸŒ¿', 'ğŸŒ±', 'ğŸŒ³'],
            dark: ['ğŸ˜ˆ', 'ğŸ‘¿', 'ğŸ’€', 'â˜ ï¸', 'ğŸ‘»', 'ğŸ‘½', 'ğŸ‘¾', 'ğŸ¤–', 'ğŸ’©', 'ğŸ˜¡', 'ğŸ¤¬', 'ğŸ˜ ', 'ğŸ‘¹', 'ğŸ‘º', 'ğŸ”¥'],
            comic: ['ğŸ’¥', 'ğŸ’«', 'â­', 'ğŸŒŸ', 'âœ¨', 'âš¡', 'ğŸ”¥', 'ğŸ’¢', 'ğŸ’¨', 'ğŸ’¦', 'ğŸ’§', 'ğŸŒˆ', 'â˜€ï¸', 'ğŸŒ™', 'â­']
        };

        // è¡¨æƒ…æ•°æ®
        const expressions = {
            happy: ['ğŸ˜€', 'ğŸ˜ƒ', 'ğŸ˜„', 'ğŸ˜', 'ğŸ˜†', 'ğŸ˜…', 'ğŸ˜‚', 'ğŸ¤£', 'ğŸ˜Š', 'ğŸ˜‡', 'ğŸ™‚', 'ğŸ™ƒ', 'ğŸ˜‰', 'ğŸ˜Œ', 'ğŸ˜', 'ğŸ¥°', 'ğŸ˜‹', 'ğŸ˜', 'ğŸ¤©', 'ğŸ¥³'],
            sad: ['ğŸ˜¢', 'ğŸ˜­', 'ğŸ˜¿', 'ğŸ˜', 'ğŸ˜”', 'ğŸ˜Ÿ', 'ğŸ˜•', 'ğŸ™', 'â˜¹ï¸', 'ğŸ˜£', 'ğŸ˜–', 'ğŸ˜«', 'ğŸ˜©', 'ğŸ¥º', 'ğŸ˜ª', 'ğŸ˜´', 'ğŸ˜µ', 'ğŸ¤§', 'ğŸ¤’', 'ğŸ¤•'],
            angry: ['ğŸ˜ ', 'ğŸ˜¡', 'ğŸ¤¬', 'ğŸ˜¤', 'ğŸ‘¿', 'ğŸ’¢', 'ğŸ”¥', 'ğŸ’¥', 'âš¡', 'ğŸ‘¹', 'ğŸ‘º', 'ğŸ˜ˆ', 'ğŸ¤¯', 'ğŸ˜µ', 'ğŸ¥µ', 'ğŸ˜¾', 'ğŸ™„', 'ğŸ˜’', 'ğŸ˜®â€ğŸ’¨', 'ğŸ’€'],
            love: ['ğŸ˜', 'ğŸ¥°', 'ğŸ˜˜', 'ğŸ˜—', 'ğŸ˜™', 'ğŸ˜š', 'ğŸ’•', 'ğŸ’–', 'ğŸ’—', 'ğŸ’˜', 'ğŸ’', 'ğŸ’', 'ğŸ’Ÿ', 'â¤ï¸', 'ğŸ§¡', 'ğŸ’›', 'ğŸ’š', 'ğŸ’™', 'ğŸ’œ', 'ğŸ¤'],
            surprise: ['ğŸ˜²', 'ğŸ˜±', 'ğŸ¤¯', 'ğŸ˜µ', 'ğŸ¤ª', 'ğŸ¤¨', 'ğŸ§', 'ğŸ¤“', 'ğŸ˜', 'ğŸ¤©', 'ğŸ¥³', 'ğŸ˜œ', 'ğŸ˜', 'ğŸ˜›', 'ğŸ¤¤', 'ğŸ¤­', 'ğŸ«¢', 'ğŸ«£', 'ğŸ¤«', 'ğŸ¤—']
        };

        // åº”ç”¨å˜æ¢åˆ°å›¾å±‚
        function applyTransform(layer, layerType) {
            const transform = layerTransforms[layerType];
            const scaleX = transform.flipX ? -transform.scale : transform.scale;

            layer.style.transform = `
                translate(calc(-50% + ${transform.x}px), calc(-50% + ${transform.y}px))
                scale(${scaleX}, ${transform.scale})
                rotate(${transform.rotation}deg)
            `;
        }

        // è¾¹ç•Œçº¦æŸ
        function constrainToBounds(layerType) {
            const previewContent = document.getElementById('previewContent');
            const rect = previewContent.getBoundingClientRect();

            const maxX = rect.width / 4;
            const maxY = rect.height / 4;

            layerTransforms[layerType].x = Math.max(-maxX, Math.min(maxX, layerTransforms[layerType].x));
            layerTransforms[layerType].y = Math.max(-maxY, Math.min(maxY, layerTransforms[layerType].y));
        }

        // åˆå§‹åŒ–é¡µé¢
        document.addEventListener('DOMContentLoaded', function() {
            initializeTabs();
            initializeMaterials();
            initializeColorPickers();
            initializeToggles();
            initializeOptions();
            initializeDefaultColors();
            initializeTouchInteraction();
        });

        // åˆå§‹åŒ–é»˜è®¤é¢œè‰²
        function initializeDefaultColors() {
            // è®¾ç½®æ–‡å­—é¢œè‰²ä¸ºé»‘è‰² (0%)
            const textColorHandle = document.getElementById('textColorHandle');
            if (textColorHandle) {
                textColorHandle.style.left = '0%';
                textColor = '#000000';
            }

            // è®¾ç½®æè¾¹é¢œè‰²ä¸ºç™½è‰² (100%)
            const strokeColorHandle = document.getElementById('strokeColorHandle');
            if (strokeColorHandle) {
                strokeColorHandle.style.left = '100%';
                strokeColor = '#ffffff';
            }
        }

        // åˆå§‹åŒ–æ ‡ç­¾é¡µåˆ‡æ¢
        function initializeTabs() {
            const tabItems = document.querySelectorAll('.tab-item');
            tabItems.forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabName = this.dataset.tab;
                    switchTab(tabName);
                });
            });
        }

        // åˆ‡æ¢æ ‡ç­¾é¡µ
        function switchTab(tabName) {
            // æ›´æ–°æ ‡ç­¾çŠ¶æ€
            document.querySelectorAll('.tab-item').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');

            // æ›´æ–°å†…å®¹åŒºåŸŸ
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(`${tabName}Tab`).classList.add('active');

            currentTab = tabName;

            // æ ¹æ®æ ‡ç­¾é¡µè®¾ç½®é»˜è®¤åˆ†ç±»
            if (tabName === 'body') {
                currentCategory = 'panda';
            } else if (tabName === 'expression') {
                currentCategory = 'happy';
            }

            updatePreview();
        }

        // åˆå§‹åŒ–ç´ æç½‘æ ¼
        function initializeMaterials() {
            generateMaterialGrid('body', 'panda');
            generateMaterialGrid('expression', 'happy');

            // åˆ†ç±»æ ‡ç­¾ç‚¹å‡»äº‹ä»¶
            document.querySelectorAll('.category-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const category = this.dataset.category || this.textContent.toLowerCase();
                    updateCategory(category);
                });
            });

            // åˆå§‹åŒ–ä¸Šä¼ æŒ‰é’®äº‹ä»¶
            document.querySelectorAll('.upload').forEach(uploadBtn => {
                uploadBtn.addEventListener('click', function() {
                    alert('ä¸Šä¼ åŠŸèƒ½æš‚æœªå¼€æ”¾');
                });
            });
        }

        // ç”Ÿæˆç´ æç½‘æ ¼
        function generateMaterialGrid(gridType, category) {
            const gridId = gridType === 'body' ? 'bodyGrid' : 'expressionGrid';
            const grid = document.getElementById(gridId);
            const materialList = gridType === 'body' ?
                (materials[category] || materials.panda) :
                (expressions[category] || expressions.happy);

            // æ¸…ç©ºç°æœ‰å†…å®¹ï¼ˆä¿ç•™ä¸Šä¼ æŒ‰é’®ï¼‰
            const uploadBtn = grid.querySelector('.upload');
            const uploadBtnHTML = uploadBtn ? uploadBtn.outerHTML : '';
            grid.innerHTML = '';

            // é‡æ–°æ·»åŠ ä¸Šä¼ æŒ‰é’®
            if (uploadBtnHTML) {
                grid.innerHTML = uploadBtnHTML;
                // é‡æ–°ç»‘å®šä¸Šä¼ æŒ‰é’®äº‹ä»¶
                const newUploadBtn = grid.querySelector('.upload');
                if (newUploadBtn) {
                    newUploadBtn.addEventListener('click', function() {
                        alert('ä¸Šä¼ åŠŸèƒ½æš‚æœªå¼€æ”¾');
                    });
                }
            }

            // æ·»åŠ ç´ æé¡¹
            materialList.forEach(material => {
                const item = document.createElement('div');
                item.className = 'material-item';
                item.textContent = material;
                item.style.fontSize = '24px';
                item.addEventListener('click', function() {
                    selectMaterial(gridType, material);
                });
                grid.appendChild(item);
            });
        }

        // é€‰æ‹©ç´ æ
        function selectMaterial(type, material) {
            if (type === 'body') {
                selectedBody = material;
                // æ›´æ–°é€‰ä¸­çŠ¶æ€
                const bodyGrid = document.getElementById('bodyGrid');
                bodyGrid.querySelectorAll('.material-item:not(.upload)').forEach(item => {
                    item.classList.remove('selected');
                    if (item.textContent === material) {
                        item.classList.add('selected');
                    }
                });
            } else {
                selectedExpression = material;
                // æ›´æ–°é€‰ä¸­çŠ¶æ€
                const expressionGrid = document.getElementById('expressionGrid');
                expressionGrid.querySelectorAll('.material-item:not(.upload)').forEach(item => {
                    item.classList.remove('selected');
                    if (item.textContent === material) {
                        item.classList.add('selected');
                    }
                });
            }
            updatePreview();
        }

        // æ›´æ–°åˆ†ç±»
        function updateCategory(category) {
            // ä¸­æ–‡åˆ†ç±»æ˜ å°„
            const categoryMap = {
                'å¼€å¿ƒ': 'happy',
                'éš¾è¿‡': 'sad',
                'æ„¤æ€’': 'angry',
                'çˆ±å¿ƒ': 'love',
                'æƒŠè®¶': 'surprise',
                'ç†ŠçŒ«': 'panda',
                'è˜‘è‡å¤´': 'mushroom',
                'åœ†è„¸': 'round',
                'å…”å­': 'rabbit',
                'é»‘æš—åŠ¿åŠ›': 'dark',
                'æ¼«ç”»': 'comic'
            };

            // å¦‚æœæ˜¯ä¸­æ–‡åˆ†ç±»åï¼Œè½¬æ¢ä¸ºè‹±æ–‡key
            const mappedCategory = categoryMap[category] || category;

            // æ›´æ–°åˆ†ç±»æ ‡ç­¾çŠ¶æ€
            const parentTab = document.querySelector('.tab-content.active');
            parentTab.querySelectorAll('.category-tab').forEach(tab => {
                tab.classList.remove('active');
            });

            const activeTab = parentTab.querySelector(`[data-category="${mappedCategory}"]`) ||
                             Array.from(parentTab.querySelectorAll('.category-tab')).find(tab =>
                                 categoryMap[tab.textContent] === mappedCategory ||
                                 tab.textContent.toLowerCase() === mappedCategory.toLowerCase());
            if (activeTab) {
                activeTab.classList.add('active');
            }

            currentCategory = mappedCategory;

            // é‡æ–°ç”Ÿæˆç´ æç½‘æ ¼
            if (currentTab === 'body') {
                generateMaterialGrid('body', mappedCategory);
            } else if (currentTab === 'expression') {
                generateMaterialGrid('expression', mappedCategory);
            }
        }

        // åˆå§‹åŒ–é¢œè‰²é€‰æ‹©å™¨
        function initializeColorPickers() {
            const textColorPicker = document.getElementById('textColorPicker');
            const strokeColorPicker = document.getElementById('strokeColorPicker');

            if (textColorPicker) {
                initializeColorPickerEvents(textColorPicker, 'textColorHandle');
            }

            if (strokeColorPicker) {
                initializeColorPickerEvents(strokeColorPicker, 'strokeColorHandle');
            }

            // æ–‡æœ¬è¾“å…¥äº‹ä»¶
            const textInput = document.getElementById('textInput');
            if (textInput) {
                textInput.addEventListener('input', function() {
                    textContent = this.value;
                    updatePreview();
                });
            }
        }

        // åˆå§‹åŒ–å•ä¸ªé¢œè‰²é€‰æ‹©å™¨çš„äº‹ä»¶
        function initializeColorPickerEvents(picker, handleId) {
            let isDragging = false;

            // ç‚¹å‡»äº‹ä»¶
            picker.addEventListener('click', function(e) {
                updateColorHandle(e, handleId);
            });

            // é¼ æ ‡æŒ‰ä¸‹äº‹ä»¶
            picker.addEventListener('mousedown', function(e) {
                isDragging = true;
                updateColorHandle(e, handleId);
                e.preventDefault();
            });

            // é¼ æ ‡ç§»åŠ¨äº‹ä»¶
            document.addEventListener('mousemove', function(e) {
                if (isDragging) {
                    const rect = picker.getBoundingClientRect();
                    if (e.clientX >= rect.left && e.clientX <= rect.right) {
                        updateColorHandle(e, handleId);
                    }
                }
            });

            // é¼ æ ‡é‡Šæ”¾äº‹ä»¶
            document.addEventListener('mouseup', function() {
                isDragging = false;
            });

            // è§¦æ‘¸äº‹ä»¶æ”¯æŒ
            picker.addEventListener('touchstart', function(e) {
                isDragging = true;
                const touch = e.touches[0];
                const mouseEvent = new MouseEvent('mousedown', {
                    clientX: touch.clientX,
                    clientY: touch.clientY
                });
                updateColorHandle(mouseEvent, handleId);
                e.preventDefault();
            });

            document.addEventListener('touchmove', function(e) {
                if (isDragging) {
                    const touch = e.touches[0];
                    const rect = picker.getBoundingClientRect();
                    if (touch.clientX >= rect.left && touch.clientX <= rect.right) {
                        const mouseEvent = new MouseEvent('mousemove', {
                            clientX: touch.clientX,
                            clientY: touch.clientY
                        });
                        updateColorHandle(mouseEvent, handleId);
                    }
                }
            });

            document.addEventListener('touchend', function() {
                isDragging = false;
            });
        }

        // æ›´æ–°é¢œè‰²æ‰‹æŸ„ä½ç½®å¹¶è®¡ç®—é¢œè‰²
        function updateColorHandle(e, handleId) {
            // è·å–é¢œè‰²é€‰æ‹©å™¨çš„ä½ç½®ä¿¡æ¯
            const colorPicker = document.getElementById(handleId).parentElement;
            const rect = colorPicker.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const percentage = Math.max(0, Math.min(100, (x / rect.width) * 100));

            const handle = document.getElementById(handleId);
            handle.style.left = percentage + '%';

            // è®¡ç®—é¢œè‰²å€¼
            const color = calculateColorFromPercentage(percentage);

            // æ›´æ–°å¯¹åº”çš„é¢œè‰²å˜é‡
            if (handleId === 'textColorHandle') {
                textColor = color;
            } else if (handleId === 'strokeColorHandle') {
                strokeColor = color;
            }

            // æ›´æ–°é¢„è§ˆ
            updatePreview();
        }

        // æ ¹æ®ç™¾åˆ†æ¯”è®¡ç®—é¢œè‰²å€¼
        function calculateColorFromPercentage(percentage) {
            // å½©è™¹è‰²è°±ï¼šé»‘ -> çº¢ -> é»„ -> ç»¿ -> é’ -> è“ -> ç´« -> ç™½
            const colors = [
                { r: 0, g: 0, b: 0 },       // é»‘è‰² 0%
                { r: 255, g: 0, b: 0 },     // çº¢è‰² 14.3%
                { r: 255, g: 255, b: 0 },   // é»„è‰² 28.6%
                { r: 0, g: 255, b: 0 },     // ç»¿è‰² 42.9%
                { r: 0, g: 255, b: 255 },   // é’è‰² 57.1%
                { r: 0, g: 0, b: 255 },     // è“è‰² 71.4%
                { r: 255, g: 0, b: 255 },   // ç´«è‰² 85.7%
                { r: 255, g: 255, b: 255 }  // ç™½è‰² 100%
            ];

            const segmentSize = 100 / (colors.length - 1);
            const segmentIndex = Math.floor(percentage / segmentSize);
            const segmentProgress = (percentage % segmentSize) / segmentSize;

            if (segmentIndex >= colors.length - 1) {
                return `rgb(${colors[colors.length - 1].r}, ${colors[colors.length - 1].g}, ${colors[colors.length - 1].b})`;
            }

            const startColor = colors[segmentIndex];
            const endColor = colors[segmentIndex + 1];

            const r = Math.round(startColor.r + (endColor.r - startColor.r) * segmentProgress);
            const g = Math.round(startColor.g + (endColor.g - startColor.g) * segmentProgress);
            const b = Math.round(startColor.b + (endColor.b - startColor.b) * segmentProgress);

            return `rgb(${r}, ${g}, ${b})`;
        }

        // åˆå§‹åŒ–å¼€å…³
        function initializeToggles() {
            const strokeToggle = document.getElementById('strokeToggle');
            if (strokeToggle) {
                strokeToggle.addEventListener('click', function() {
                    strokeEnabled = !strokeEnabled;
                    this.classList.toggle('off', !strokeEnabled);
                });
            }
        }

        // åˆå§‹åŒ–é€‰é¡¹æŒ‰é’®
        function initializeOptions() {
            document.querySelectorAll('.option-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const parent = this.parentElement;
                    parent.querySelectorAll('.option-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                });
            });

            const generateBtn = document.getElementById('generateBtn');
            if (generateBtn) {
                generateBtn.addEventListener('click', function() {
                    alert('è¡¨æƒ…åŒ…ç”Ÿæˆå®Œæˆï¼');
                });
            }
        }

        // æ›´æ–°é¢„è§ˆ
        function updatePreview() {
            const bodyLayer = document.getElementById('bodyLayer');
            const expressionLayer = document.getElementById('expressionLayer');
            const textLayer = document.getElementById('textLayer');
            const defaultHint = document.getElementById('defaultHint');

            // æ›´æ–°ç”Ÿæˆé¡µé¢
            if (currentTab === 'generate') {
                updateGeneratePreview();
                return;
            }

            // æ›´æ–°å›¾å±‚æ˜¾ç¤º
            updateLayerVisibility();

            // æ›´æ–°èº«ä½“å›¾å±‚
            if (selectedBody) {
                bodyLayer.textContent = selectedBody;
                bodyLayer.style.display = 'flex';
                applyTransform(bodyLayer, 'body');
            } else {
                bodyLayer.style.display = 'none';
            }

            // æ›´æ–°è¡¨æƒ…å›¾å±‚
            if (selectedExpression) {
                expressionLayer.textContent = selectedExpression;
                expressionLayer.style.display = 'flex';
                applyTransform(expressionLayer, 'expression');
            } else {
                expressionLayer.style.display = 'none';
            }

            // æ›´æ–°æ–‡å­—å›¾å±‚
            if (textContent) {
                textLayer.textContent = textContent;
                textLayer.style.color = textColor;

                // åº”ç”¨æè¾¹æ•ˆæœ
                if (strokeEnabled) {
                    textLayer.style.textShadow = `
                        -1px -1px 0 ${strokeColor},
                        1px -1px 0 ${strokeColor},
                        -1px 1px 0 ${strokeColor},
                        1px 1px 0 ${strokeColor},
                        -2px 0 0 ${strokeColor},
                        2px 0 0 ${strokeColor},
                        0 -2px 0 ${strokeColor},
                        0 2px 0 ${strokeColor}
                    `;
                } else {
                    textLayer.style.textShadow = 'none';
                }

                textLayer.style.display = 'flex';
                applyTransform(textLayer, 'text');
            } else {
                textLayer.style.display = 'none';
            }

            // æ§åˆ¶é»˜è®¤æç¤ºçš„æ˜¾ç¤º
            let hasAnyContent = false;
            let hintText = 'è¯·é€‰æ‹©ç´ æ';

            if (currentTab === 'body') {
                hasAnyContent = selectedBody;
                hintText = 'è¯·é€‰æ‹©èº«ä½“ç´ æ';
            } else if (currentTab === 'expression') {
                hasAnyContent = selectedExpression;
                hintText = 'è¯·é€‰æ‹©è¡¨æƒ…ç´ æ';
            } else if (currentTab === 'text') {
                hasAnyContent = textContent;
                hintText = 'è¯·è¾“å…¥æ–‡å­—å†…å®¹';
            } else {
                hasAnyContent = selectedBody || selectedExpression || textContent;
                hintText = 'è¯·é€‰æ‹©ç´ æ';
            }

            defaultHint.style.display = hasAnyContent ? 'none' : 'flex';
            defaultHint.textContent = hintText;
        }

        // æ›´æ–°å›¾å±‚å¯è§æ€§
        function updateLayerVisibility() {
            const bodyLayer = document.getElementById('bodyLayer');
            const expressionLayer = document.getElementById('expressionLayer');
            const textLayer = document.getElementById('textLayer');

            // ç¡®ä¿å›¾å±‚æŒ‰æ­£ç¡®çš„z-indexé¡ºåºæ˜¾ç¤º
            bodyLayer.style.zIndex = '1';
            expressionLayer.style.zIndex = '2';
            textLayer.style.zIndex = '3';
        }

        // æ›´æ–°ç”Ÿæˆé¡µé¢é¢„è§ˆ
        function updateGeneratePreview() {
            const generateBodyLayer = document.getElementById('generateBodyLayer');
            const generateExpressionLayer = document.getElementById('generateExpressionLayer');
            const generateTextLayer = document.getElementById('generateTextLayer');

            // æ›´æ–°èº«ä½“å›¾å±‚
            if (selectedBody) {
                generateBodyLayer.textContent = selectedBody;
                generateBodyLayer.style.display = 'flex';
            } else {
                generateBodyLayer.style.display = 'none';
            }

            // æ›´æ–°è¡¨æƒ…å›¾å±‚
            if (selectedExpression) {
                generateExpressionLayer.textContent = selectedExpression;
                generateExpressionLayer.style.display = 'flex';
            } else {
                generateExpressionLayer.style.display = 'none';
            }

            // æ›´æ–°æ–‡å­—å›¾å±‚
            if (textContent) {
                generateTextLayer.textContent = textContent;
                generateTextLayer.style.color = textColor;

                // åº”ç”¨æè¾¹æ•ˆæœ
                if (strokeEnabled) {
                    generateTextLayer.style.textShadow = `
                        -1px -1px 0 ${strokeColor},
                        1px -1px 0 ${strokeColor},
                        -1px 1px 0 ${strokeColor},
                        1px 1px 0 ${strokeColor},
                        -2px 0 0 ${strokeColor},
                        2px 0 0 ${strokeColor},
                        0 -2px 0 ${strokeColor},
                        0 2px 0 ${strokeColor}
                    `;
                } else {
                    generateTextLayer.style.textShadow = 'none';
                }

                generateTextLayer.style.display = 'flex';
            } else {
                generateTextLayer.style.display = 'none';
            }

            // ç¡®ä¿ç”Ÿæˆé¡µé¢å›¾å±‚æŒ‰æ­£ç¡®çš„z-indexé¡ºåºæ˜¾ç¤º
            generateBodyLayer.style.zIndex = '1';
            generateExpressionLayer.style.zIndex = '2';
            generateTextLayer.style.zIndex = '3';
        }

        // åˆå§‹åŒ–è§¦æ‘¸äº¤äº’
        function initializeTouchInteraction() {
            const layers = ['bodyLayer', 'expressionLayer', 'textLayer'];

            layers.forEach(layerId => {
                const layer = document.getElementById(layerId);
                if (layer) {
                    // æ·»åŠ è§¦æ‘¸äº‹ä»¶ç›‘å¬å™¨
                    layer.addEventListener('touchstart', handleTouchStart, { passive: false });
                    layer.addEventListener('touchmove', handleTouchMove, { passive: false });
                    layer.addEventListener('touchend', handleTouchEnd, { passive: false });

                    // æ·»åŠ é¼ æ ‡äº‹ä»¶ç›‘å¬å™¨ï¼ˆç”¨äºæ¡Œé¢æµ‹è¯•ï¼‰
                    layer.addEventListener('mousedown', handleMouseDown);
                    layer.addEventListener('mousemove', handleMouseMove);
                    layer.addEventListener('mouseup', handleMouseUp);

                    // æ·»åŠ ç‚¹å‡»äº‹ä»¶ç›‘å¬å™¨ï¼ˆæ°´å¹³ç¿»è½¬ï¼‰
                    layer.addEventListener('click', handleLayerClick);
                }
            });
        }
        // è§¦æ‘¸å¼€å§‹äº‹ä»¶å¤„ç†
        function handleTouchStart(e) {
            e.preventDefault();
            const layerType = getLayerType(e.target);
            if (!layerType) return;

            touchState.activeLayer = layerType;
            touchState.startTouches = Array.from(e.touches);
            touchState.lastTouches = Array.from(e.touches);
            touchState.initialTransform = { ...layerTransforms[layerType] };

            if (e.touches.length === 1) {
                touchState.isDragging = true;
                e.target.classList.add('interactive');
            } else if (e.touches.length === 2) {
                touchState.isScaling = true;
                touchState.initialDistance = getTouchDistance(e.touches[0], e.touches[1]);
                touchState.initialAngle = getTouchAngle(e.touches[0], e.touches[1]);
                e.target.classList.add('interactive');
            }
        }

        // è§¦æ‘¸ç§»åŠ¨äº‹ä»¶å¤„ç†
        function handleTouchMove(e) {
            e.preventDefault();
            if (!touchState.activeLayer) return;

            const layerType = touchState.activeLayer;
            const layer = document.getElementById(layerType + 'Layer');

            if (touchState.isDragging && e.touches.length === 1) {
                // å•æŒ‡æ‹–æ‹½
                const touch = e.touches[0];
                const lastTouch = touchState.lastTouches[0];

                const deltaX = touch.clientX - lastTouch.clientX;
                const deltaY = touch.clientY - lastTouch.clientY;

                layerTransforms[layerType].x += deltaX;
                layerTransforms[layerType].y += deltaY;

                // è¾¹ç•Œæ£€æµ‹
                constrainToBounds(layerType);

                applyTransform(layer, layerType);
                touchState.lastTouches = Array.from(e.touches);

            } else if (touchState.isScaling && e.touches.length === 2) {
                // åŒæŒ‡ç¼©æ”¾å’Œæ—‹è½¬
                const currentDistance = getTouchDistance(e.touches[0], e.touches[1]);
                const currentAngle = getTouchAngle(e.touches[0], e.touches[1]);

                // è®¡ç®—ç¼©æ”¾æ¯”ä¾‹
                const scaleChange = currentDistance / touchState.initialDistance;
                let newScale = touchState.initialTransform.scale * scaleChange;
                newScale = Math.max(0.5, Math.min(3, newScale)); // é™åˆ¶ç¼©æ”¾èŒƒå›´

                // è®¡ç®—æ—‹è½¬è§’åº¦
                const rotationChange = currentAngle - touchState.initialAngle;
                const newRotation = touchState.initialTransform.rotation + rotationChange;

                layerTransforms[layerType].scale = newScale;
                layerTransforms[layerType].rotation = newRotation;

                applyTransform(layer, layerType);
            }
        }

        // è§¦æ‘¸ç»“æŸäº‹ä»¶å¤„ç†
        function handleTouchEnd(e) {
            e.preventDefault();
            if (!touchState.activeLayer) return;

            const layerType = touchState.activeLayer;
            const layer = document.getElementById(layerType + 'Layer');

            layer.classList.remove('interactive');

            // é‡ç½®è§¦æ‘¸çŠ¶æ€
            touchState.isDragging = false;
            touchState.isScaling = false;
            touchState.activeLayer = null;
            touchState.startTouches = [];
            touchState.lastTouches = [];
        }

        // é¼ æ ‡äº‹ä»¶å¤„ç†ï¼ˆç”¨äºæ¡Œé¢æµ‹è¯•ï¼‰
        function handleMouseDown(e) {
            const layerType = getLayerType(e.target);
            if (!layerType) return;

            touchState.activeLayer = layerType;
            touchState.isDragging = true;
            touchState.initialTransform = { ...layerTransforms[layerType] };

            const fakeTouch = { clientX: e.clientX, clientY: e.clientY };
            touchState.lastTouches = [fakeTouch];

            e.target.classList.add('interactive');
            e.preventDefault();
        }

        function handleMouseMove(e) {
            if (!touchState.isDragging || !touchState.activeLayer) return;

            const layerType = touchState.activeLayer;
            const layer = document.getElementById(layerType + 'Layer');
            const lastTouch = touchState.lastTouches[0];

            const deltaX = e.clientX - lastTouch.clientX;
            const deltaY = e.clientY - lastTouch.clientY;

            layerTransforms[layerType].x += deltaX;
            layerTransforms[layerType].y += deltaY;

            constrainToBounds(layerType);
            applyTransform(layer, layerType);

            touchState.lastTouches = [{ clientX: e.clientX, clientY: e.clientY }];
        }

        function handleMouseUp(e) {
            if (!touchState.activeLayer) return;

            const layerType = touchState.activeLayer;
            const layer = document.getElementById(layerType + 'Layer');

            layer.classList.remove('interactive');

            touchState.isDragging = false;
            touchState.activeLayer = null;
            touchState.lastTouches = [];
        }

        // ç‚¹å‡»äº‹ä»¶å¤„ç†ï¼ˆæ°´å¹³ç¿»è½¬ï¼‰
        function handleLayerClick(e) {
            // é˜²æ­¢æ‹–æ‹½æ—¶è§¦å‘ç‚¹å‡»
            if (touchState.isDragging || touchState.isScaling) return;

            const layerType = getLayerType(e.target);
            if (!layerType) return;

            const layer = document.getElementById(layerType + 'Layer');

            // åˆ‡æ¢ç¿»è½¬çŠ¶æ€
            layerTransforms[layerType].flipX = !layerTransforms[layerType].flipX;

            // æ·»åŠ ç¿»è½¬åŠ¨ç”»ç±»
            layer.classList.add('flipping');

            applyTransform(layer, layerType);

            // ç§»é™¤åŠ¨ç”»ç±»
            setTimeout(() => {
                layer.classList.remove('flipping');
            }, 300);
        }

        // è·å–å›¾å±‚ç±»å‹
        function getLayerType(element) {
            if (element.id === 'bodyLayer') return 'body';
            if (element.id === 'expressionLayer') return 'expression';
            if (element.id === 'textLayer') return 'text';
            return null;
        }

        // è®¡ç®—ä¸¤ä¸ªè§¦æ‘¸ç‚¹ä¹‹é—´çš„è·ç¦»
        function getTouchDistance(touch1, touch2) {
            const dx = touch2.clientX - touch1.clientX;
            const dy = touch2.clientY - touch1.clientY;
            return Math.sqrt(dx * dx + dy * dy);
        }

        // è®¡ç®—ä¸¤ä¸ªè§¦æ‘¸ç‚¹ä¹‹é—´çš„è§’åº¦
        function getTouchAngle(touch1, touch2) {
            const dx = touch2.clientX - touch1.clientX;
            const dy = touch2.clientY - touch1.clientY;
            return Math.atan2(dy, dx) * 180 / Math.PI;
        }



        // é‡ç½®å›¾å±‚å˜æ¢
        function resetLayerTransform(layerType) {
            layerTransforms[layerType] = { x: 0, y: 0, scale: 1, rotation: 0, flipX: false };
            const layer = document.getElementById(layerType + 'Layer');
            if (layer) {
                applyTransform(layer, layerType);
            }
        }

        // é‡ç½®æ‰€æœ‰å›¾å±‚å˜æ¢
        function resetAllTransforms() {
            Object.keys(layerTransforms).forEach(layerType => {
                resetLayerTransform(layerType);
            });
        }

    </script>
</body>
</html>
