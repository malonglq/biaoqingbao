<!--image-editor.wxml-->
<view class="container">
  <!-- 安全区域适配 -->
  <view class="safe-area-top" style="height: {{safeAreaHeight}}rpx;"></view>

  <!-- 预览区域 -->
  <view class="preview-area">
    <canvas-editor
      id="canvasEditor"
      image-src="{{imageSrc}}"
      canvas-width="{{canvasWidth}}"
      canvas-height="{{canvasHeight}}"
      current-tool="{{currentTool}}"
      tool-config="{{toolConfig}}"
      bind:canvasReady="onCanvasReady"
      bind:imageLoaded="onImageLoaded"
      bind:imageDataReady="onImageDataReady"
      bind:operationComplete="onOperationComplete"
    ></canvas-editor>
  </view>

  <!-- 工具栏 -->
  <view class="tool-bar">
    <!-- 功能按钮区域 - 所有功能按钮排列在同一行 -->
    <view class="function-buttons">
      <view
        class="function-btn {{currentFilter === 'grayscale' ? 'active' : ''}}"
        bindtap="selectFilter"
        data-filter="grayscale"
      >
        <view class="function-icon">⚫</view>
        <text>黑白</text>
      </view>
      <view
        class="function-btn {{currentFilter === 'opacity' ? 'active' : ''}}"
        bindtap="selectFilter"
        data-filter="opacity"
      >
        <view class="function-icon">◐</view>
        <text>透明化</text>
      </view>
      <view
        class="function-btn {{currentTool === 'brush' ? 'active' : ''}}"
        bindtap="selectTool"
        data-tool="brush"
      >
        <view class="function-icon">✏️</view>
        <text>笔刷</text>
      </view>
      <view
        class="function-btn {{currentTool === 'eraser' ? 'active' : ''}}"
        bindtap="selectTool"
        data-tool="eraser"
      >
        <view class="function-icon">🧽</view>
        <text>橡皮擦</text>
      </view>
    </view>

    <!-- 参数控制区域 - 通用滑块，所有功能共享使用 -->
    <view class="param-control" wx:if="{{showParamControl}}">
      <text class="param-label">{{paramLabel}}: {{paramValue}}{{paramUnit}}</text>
      <slider
        class="universal-slider"
        min="{{paramMin}}"
        max="{{paramMax}}"
        value="{{paramValue}}"
        bindchange="onParamChange"
        bindchanging="onParamChanging"
        activeColor="#FF6B6B"
        backgroundColor="#E2E8F0"
      />
    </view>

    <!-- 笔刷颜色选择（仅在笔刷工具激活时显示） -->
    <view class="color-control" wx:if="{{currentTool === 'brush'}}">
      <text class="param-label">颜色</text>
      <view class="color-options">
        <view
          class="color-option {{toolConfig.brushColor === item ? 'selected' : ''}}"
          wx:for="{{colorOptions}}"
          wx:key="*this"
          style="background-color: {{item}};"
          bindtap="selectBrushColor"
          data-color="{{item}}"
        ></view>
      </view>
    </view>

    <!-- 操作确认区域 - 通用的应用/确认按钮 -->
    <view class="confirm-control" wx:if="{{showConfirmButton}}">
      <view class="confirm-btn" bindtap="applyCurrentEffect">
        <view class="confirm-icon">✓</view>
        <text>应用效果</text>
      </view>
    </view>
  </view>

  <!-- 操作栏 -->
  <view class="action-bar">
    <view class="action-buttons">
      <view 
        class="action-btn {{!canUndo ? 'disabled' : ''}}"
        bindtap="undo"
      >
        <view class="action-icon">↶</view>
        <text>撤销</text>
      </view>
      <view 
        class="action-btn {{!canRedo ? 'disabled' : ''}}"
        bindtap="redo"
      >
        <view class="action-icon">↷</view>
        <text>重做</text>
      </view>
      <view 
        class="action-btn"
        bindtap="reset"
      >
        <view class="action-icon">🔄</view>
        <text>重置</text>
      </view>
      <view 
        class="action-btn cancel"
        bindtap="cancel"
      >
        <view class="action-icon">✕</view>
        <text>取消</text>
      </view>
      <view 
        class="action-btn save"
        bindtap="save"
      >
        <view class="action-icon">✓</view>
        <text>保存</text>
      </view>
    </view>
  </view>
</view>
