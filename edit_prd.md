# 图片编辑功能 PRD (Product Requirements Document)

## 📋 项目概述

### 项目背景
为微信小程序表情包项目新增图片编辑功能，允许用户对上传的自定义图片进行基础编辑操作，提升用户体验和表情包制作的灵活性。

### 功能范围
严格按照需求执行，不增不减：
1. **滤镜效果**：黑白滤镜、透明化效果
2. **画笔功能**：橡皮擦工具、笔刷工具  
3. **重置功能**：恢复到编辑前的原始状态

## 🎯 功能需求详细说明

### 1. 滤镜效果
- **黑白滤镜**：将彩色图片转换为黑白效果
- **透明化效果**：调整图片整体透明度（0-100%）

### 2. 画笔功能
- **笔刷工具**：在图片上绘制内容，支持颜色选择和笔刷大小调整
- **橡皮擦工具**：擦除绘制的内容或图片部分区域

### 3. 重置功能
- **一键重置**：恢复到编辑前的原始图片状态
- **清除所有编辑操作**：包括滤镜、绘制内容等

### 4. 操作历史
- **撤销功能**：撤销上一步操作
- **重做功能**：重做已撤销的操作
- **历史记录管理**：维护操作历史栈

## 📱 用户交互流程

### 编辑入口
1. 用户在"选身体"或"选表情"页面点击自定义图片
2. 图片被选中后，显示"编辑"按钮
3. 点击"编辑"按钮跳转到图片编辑页面

### 编辑界面操作
1. **顶部预览区域**：显示当前编辑状态的图片
2. **中部工具栏**：滤镜、画笔、橡皮擦工具选择
3. **底部操作栏**：撤销、重做、重置、保存、取消按钮
4. **实时预览**：所有操作立即在预览区域显示效果

### 保存和返回
1. 点击"保存"按钮确认编辑
2. 编辑后的图片替换原图片
3. 返回原页面，更新图片显示

## 🎨 UI设计规范

### 设计风格
- 保持与现有项目UI风格一致
- 参考ui.html的色彩方案和组件样式
- 使用项目现有的CSS变量和样式类

### 布局结构
```
┌─────────────────────────────────┐
│           预览区域               │  <- 复用preview-area样式
│        (Canvas画布)             │
├─────────────────────────────────┤
│     工具栏 (滤镜/画笔/橡皮擦)     │  <- 参考tab-bar样式
├─────────────────────────────────┤
│  操作栏 (撤销/重做/重置/保存/取消) │  <- 参考bottom-nav样式
└─────────────────────────────────┘
```

### 色彩方案
- 主色调：#FF6B6B (--primary-color)
- 次要色：#FFE66D (--secondary-color) 
- 强调色：#9C88FF (--accent-color)
- 背景色：#F7FAFC (--container-secondary)

## 🔧 技术实现方案

### 技术架构
```
pages/
├── image-editor/              # 图片编辑页面
│   ├── image-editor.js       # 页面逻辑
│   ├── image-editor.wxml     # 页面结构
│   ├── image-editor.wxss     # 页面样式
│   └── image-editor.json     # 页面配置

components/
├── canvas-editor/            # Canvas编辑器组件
│   ├── canvas-editor.js      # 组件逻辑
│   ├── canvas-editor.wxml    # 组件结构
│   ├── canvas-editor.wxss    # 组件样式
│   └── canvas-editor.json    # 组件配置

utils/
├── imageProcessor.js         # 图片处理工具
├── canvasUtils.js           # Canvas操作工具
└── editHistory.js           # 编辑历史管理
```

### 核心技术点
1. **Canvas 2D API**：用于图片渲染和编辑操作
2. **图片处理算法**：滤镜效果实现
3. **触摸事件处理**：画笔和橡皮擦操作
4. **历史记录管理**：撤销/重做功能
5. **图片导出**：编辑完成后的图片保存

### 性能优化
1. **离屏Canvas**：提高渲染性能
2. **操作防抖**：避免频繁重绘
3. **内存管理**：及时释放Canvas资源
4. **图片压缩**：控制输出图片大小

## 📂 文件结构规划

### 新增文件
```
miniprogram/
├── pages/
│   └── image-editor/         # 新增：图片编辑页面
├── components/
│   └── canvas-editor/        # 新增：Canvas编辑器组件
└── utils/
    ├── imageProcessor.js     # 新增：图片处理工具
    ├── canvasUtils.js        # 新增：Canvas操作工具
    └── editHistory.js        # 新增：编辑历史管理
```

### 修改文件
```
miniprogram/
├── app.json                  # 修改：添加新页面路由
├── pages/index/
│   ├── index.js             # 修改：添加编辑入口逻辑
│   └── index.wxml           # 修改：添加编辑按钮
└── utils/
    └── imageUpload.js        # 修改：集成编辑功能
```

## 🚀 开发步骤

### 第一阶段：基础架构搭建
1. 创建图片编辑页面和路由配置
2. 创建Canvas编辑器组件
3. 实现基础的图片加载和显示

### 第二阶段：核心功能开发
1. 实现滤镜效果（黑白、透明化）
2. 实现画笔工具（绘制功能）
3. 实现橡皮擦工具（擦除功能）
4. 实现重置功能

### 第三阶段：交互优化
1. 实现撤销/重做功能
2. 优化触摸交互体验
3. 添加工具参数调整（笔刷大小、透明度等）

### 第四阶段：集成测试
1. 与现有上传流程集成
2. 编辑入口和返回逻辑
3. 数据流和状态管理
4. 性能优化和测试

## ⚠️ 技术约束和注意事项

### 微信小程序限制
1. Canvas API版本兼容性
2. 内存使用限制
3. 图片尺寸和格式限制
4. 触摸事件处理差异

### 性能考虑
1. 大图片处理优化
2. Canvas渲染性能
3. 内存泄漏防护
4. 用户体验流畅性

### 兼容性要求
1. 不同设备屏幕适配
2. 不同微信版本兼容
3. iOS/Android平台差异
4. 低端设备性能优化

## 📊 验收标准

### 功能验收
- [ ] 滤镜效果正常工作
- [ ] 画笔工具可正常绘制
- [ ] 橡皮擦工具可正常擦除
- [ ] 重置功能恢复原始状态
- [ ] 撤销/重做功能正常
- [ ] 编辑结果正确保存和应用

### 性能验收
- [ ] 编辑操作响应时间 < 200ms
- [ ] 大图片(5MB)编辑不卡顿
- [ ] 内存使用控制在合理范围
- [ ] 无明显内存泄漏

### 用户体验验收
- [ ] 界面风格与现有项目一致
- [ ] 操作流程直观易懂
- [ ] 错误处理友好
- [ ] 加载状态提示清晰

## 📅 开发时间规划

- **第一阶段**：2-3小时（基础架构）
- **第二阶段**：4-5小时（核心功能）
- **第三阶段**：2-3小时（交互优化）
- **第四阶段**：2-3小时（集成测试）

**总计预估**：10-14小时

---

*本PRD文档将作为图片编辑功能开发的指导文档，所有开发工作严格按照此文档执行。*
