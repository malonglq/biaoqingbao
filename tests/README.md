# æ»¤é•œåŠŸèƒ½æµ‹è¯•å¥—ä»¶

è¿™æ˜¯ä¸€ä¸ªå®Œæ•´çš„æµ‹è¯•å¥—ä»¶ï¼Œç”¨äºéªŒè¯æ»¤é•œé—ªçƒé—®é¢˜çš„ä¿®å¤æ•ˆæœã€‚

## ğŸ“ æµ‹è¯•ç»“æ„

```
tests/
â”œâ”€â”€ unit/                          # å•å…ƒæµ‹è¯•
â”‚   â””â”€â”€ canvas-editor-filter.test.js  # Canvasç¼–è¾‘å™¨æ»¤é•œåŠŸèƒ½å•å…ƒæµ‹è¯•
â”œâ”€â”€ integration/                   # é›†æˆæµ‹è¯•
â”‚   â””â”€â”€ filter-integration.test.js    # æ»¤é•œåŠŸèƒ½é›†æˆæµ‹è¯•
â”œâ”€â”€ fixtures/                      # æµ‹è¯•å›ºä»¶
â”‚   â””â”€â”€ filter-test-page.html        # æµ‹è¯•é¡µé¢HTML
â”œâ”€â”€ jest.config.js                 # Jesté…ç½®æ–‡ä»¶
â”œâ”€â”€ setup.js                       # æµ‹è¯•ç¯å¢ƒè®¾ç½®
â”œâ”€â”€ run-tests.js                   # æµ‹è¯•è¿è¡Œè„šæœ¬
â”œâ”€â”€ package.json                   # æµ‹è¯•ä¾èµ–é…ç½®
â””â”€â”€ README.md                      # æœ¬æ–‡æ¡£
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–

```bash
cd tests
npm run install-deps
```

æˆ–è€…æ‰‹åŠ¨å®‰è£…ï¼š

```bash
npm install --save-dev jest puppeteer @babel/core @babel/preset-env babel-jest jsdom identity-obj-proxy
```

### 2. è¿è¡Œæµ‹è¯•

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
npm test

# åªè¿è¡Œå•å…ƒæµ‹è¯•
npm run test:unit

# åªè¿è¡Œé›†æˆæµ‹è¯•
npm run test:integration

# ç›‘è§†æ¨¡å¼è¿è¡Œæµ‹è¯•
npm run test:watch

# ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
npm run test:coverage
```

## ğŸ§ª æµ‹è¯•å†…å®¹

### å•å…ƒæµ‹è¯• (unit/canvas-editor-filter.test.js)

æµ‹è¯•Canvasç¼–è¾‘å™¨ç»„ä»¶çš„æ ¸å¿ƒæ»¤é•œåŠŸèƒ½ï¼š

#### 1. æ»¤é•œçŠ¶æ€ç®¡ç†æµ‹è¯•
- âœ… æ­£ç¡®è®¾ç½®å’Œæ¸…é™¤æ»¤é•œå¤„ç†çŠ¶æ€
- âœ… é˜²æ­¢é‡å¤çš„æ»¤é•œå¤„ç†
- âœ… çŠ¶æ€æ ‡å¿—çš„æ­£ç¡®ç®¡ç†

#### 2. é€æ˜åº¦æ»¤é•œæµ‹è¯•
- âœ… æ­£ç¡®åº”ç”¨é€æ˜åº¦æ»¤é•œ
- âœ… å®æ—¶é€æ˜åº¦è°ƒèŠ‚å¤„ç†
- âœ… é€æ˜åº¦æ»¤é•œç®—æ³•éªŒè¯
- âœ… Canvasæ“ä½œåºåˆ—éªŒè¯

#### 3. é»‘ç™½æ»¤é•œæµ‹è¯•
- âœ… æ­£ç¡®åº”ç”¨é»‘ç™½æ»¤é•œ
- âœ… é»‘ç™½æ»¤é•œç®—æ³•éªŒè¯
- âœ… å¼ºåº¦å‚æ•°å¤„ç†

#### 4. Canvasåˆ·æ–°æœºåˆ¶æµ‹è¯•
- âœ… å¼ºåˆ¶åˆ·æ–°æ–¹æ³•è°ƒç”¨
- âœ… å…¼å®¹æ€§å¤„ç†

#### 5. requestAnimationFrameæœºåˆ¶æµ‹è¯•
- âœ… ä¼˜å…ˆä½¿ç”¨Canvasçš„requestAnimationFrame
- âœ… setTimeoutå›é€€æ–¹æ¡ˆ

#### 6. é”™è¯¯å¤„ç†æµ‹è¯•
- âœ… å¤„ç†æ²¡æœ‰åŸå§‹å›¾åƒçš„æƒ…å†µ
- âœ… æ»¤é•œå¤„ç†è¿‡ç¨‹ä¸­çš„é”™è¯¯å¤„ç†
- âœ… çŠ¶æ€æ¸…ç†éªŒè¯

### é›†æˆæµ‹è¯• (integration/filter-integration.test.js)

ä½¿ç”¨Puppeteerè¿›è¡Œç«¯åˆ°ç«¯æµ‹è¯•ï¼š

#### 1. æ»¤é•œé—ªçƒé—®é¢˜éªŒè¯
- âœ… é€æ˜åº¦æ»¤é•œç¨³å®šæ˜¾ç¤ºä¸é—ªçƒ
- âœ… é»‘ç™½æ»¤é•œç¨³å®šæ˜¾ç¤ºä¸é—ªçƒ
- âœ… æ»¤é•œæ•ˆæœæŒä¹…æ€§éªŒè¯

#### 2. å®æ—¶æ»¤é•œè°ƒèŠ‚æµ‹è¯•
- âœ… å¿«é€Ÿæ‹–åŠ¨é€æ˜åº¦æ»‘å—æµç•…å“åº”
- âœ… é˜²æŠ–æœºåˆ¶éªŒè¯
- âœ… ç”¨æˆ·äº¤äº’ä½“éªŒæµ‹è¯•

#### 3. å¹¶å‘æ“ä½œæµ‹è¯•
- âœ… å¿«é€Ÿåˆ‡æ¢ä¸åŒæ»¤é•œæ— å†²çª
- âœ… çŠ¶æ€ç®¡ç†å¯é æ€§
- âœ… é”™è¯¯å¤„ç†éªŒè¯

#### 4. æ€§èƒ½æµ‹è¯•
- âœ… æ»¤é•œå¤„ç†æ—¶é—´åœ¨åˆç†èŒƒå›´å†…
- âœ… å“åº”æ€§èƒ½éªŒè¯

#### 5. å†…å­˜æ³„æ¼æµ‹è¯•
- âœ… é‡å¤åº”ç”¨æ»¤é•œä¸å¯¼è‡´å†…å­˜æ³„æ¼
- âœ… èµ„æºæ¸…ç†éªŒè¯

## ğŸ“Š æµ‹è¯•æŠ¥å‘Š

è¿è¡Œæµ‹è¯•åï¼Œä¼šç”Ÿæˆä»¥ä¸‹æŠ¥å‘Šï¼š

1. **æ§åˆ¶å°è¾“å‡º**ï¼šå®æ—¶æµ‹è¯•ç»“æœå’Œè¦†ç›–ç‡ç»Ÿè®¡
2. **HTMLè¦†ç›–ç‡æŠ¥å‘Š**ï¼š`tests/coverage/lcov-report/index.html`
3. **LCOVæŠ¥å‘Š**ï¼š`tests/coverage/lcov.info`

## ğŸ”§ é…ç½®è¯´æ˜

### Jesté…ç½® (jest.config.js)
- æµ‹è¯•ç¯å¢ƒï¼šjsdom
- è¦†ç›–ç‡é˜ˆå€¼ï¼š70%
- æ¨¡å—æ˜ å°„å’Œè½¬æ¢é…ç½®
- è¶…æ—¶è®¾ç½®ï¼š10ç§’

### æµ‹è¯•ç¯å¢ƒè®¾ç½® (setup.js)
- å¾®ä¿¡å°ç¨‹åºAPIæ¨¡æ‹Ÿ
- Canvas APIæ¨¡æ‹Ÿ
- å…¨å±€å˜é‡å’Œå·¥å…·å‡½æ•°
- é”™è¯¯å¤„ç†é…ç½®

## ğŸ¯ éªŒè¯ç›®æ ‡

è¿™ä¸ªæµ‹è¯•å¥—ä»¶ä¸»è¦éªŒè¯ä»¥ä¸‹ä¿®å¤æ•ˆæœï¼š

### 1. æ»¤é•œé—ªçƒé—®é¢˜è§£å†³
- âŒ **ä¿®å¤å‰**ï¼šæ»¤é•œæ•ˆæœçŸ­æš‚æ˜¾ç¤ºåè¢«åŸå›¾è¦†ç›–
- âœ… **ä¿®å¤å**ï¼šæ»¤é•œæ•ˆæœç¨³å®šæ˜¾ç¤ºï¼Œä¸å†é—ªçƒ

### 2. çŠ¶æ€ç®¡ç†ä¼˜åŒ–
- âŒ **ä¿®å¤å‰**ï¼šç¼ºä¹çŠ¶æ€ç®¡ç†ï¼Œå¯èƒ½å¯¼è‡´å¹¶å‘å†²çª
- âœ… **ä¿®å¤å**ï¼šå®Œå–„çš„çŠ¶æ€ç®¡ç†ï¼Œé˜²æ­¢é‡å¤å¤„ç†

### 3. æ¸²æŸ“æ—¶åºä¼˜åŒ–
- âŒ **ä¿®å¤å‰**ï¼šä½¿ç”¨setTimeoutå¯¼è‡´æ—¶åºé—®é¢˜
- âœ… **ä¿®å¤å**ï¼šä½¿ç”¨requestAnimationFrameç¡®ä¿æ­£ç¡®æ—¶åº

### 4. æ€§èƒ½ä¼˜åŒ–
- âŒ **ä¿®å¤å‰**ï¼šé¢‘ç¹çš„Canvasæ“ä½œå½±å“æ€§èƒ½
- âœ… **ä¿®å¤å**ï¼šé˜²æŠ–å¤„ç†å’Œä¼˜åŒ–çš„æ¸²æŸ“æœºåˆ¶

## ğŸ› æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **ä¾èµ–å®‰è£…å¤±è´¥**
   ```bash
   # æ¸…ç†ç¼“å­˜é‡æ–°å®‰è£…
   npm cache clean --force
   npm install
   ```

2. **Puppeteerå®‰è£…é—®é¢˜**
   ```bash
   # è®¾ç½®é•œåƒæº
   npm config set puppeteer_download_host=https://npm.taobao.org/mirrors
   npm install puppeteer
   ```

3. **æµ‹è¯•è¶…æ—¶**
   - æ£€æŸ¥ç½‘ç»œè¿æ¥
   - å¢åŠ Jestè¶…æ—¶è®¾ç½®
   - ç¡®ä¿æ²¡æœ‰å…¶ä»–è¿›ç¨‹å ç”¨ç«¯å£

4. **Canvasç›¸å…³é”™è¯¯**
   - ç¡®ä¿jsdomç¯å¢ƒæ­£ç¡®é…ç½®
   - æ£€æŸ¥Canvas APIæ¨¡æ‹Ÿæ˜¯å¦å®Œæ•´

### è°ƒè¯•æŠ€å·§

1. **å¯ç”¨è¯¦ç»†è¾“å‡º**
   ```bash
   npm test -- --verbose
   ```

2. **è¿è¡Œç‰¹å®šæµ‹è¯•**
   ```bash
   npm test -- --testNamePattern="é€æ˜åº¦æ»¤é•œ"
   ```

3. **è°ƒè¯•æ¨¡å¼**
   ```bash
   npm test -- --detectOpenHandles --forceExit
   ```

## ğŸ“ˆ æŒç»­é›†æˆ

å¯ä»¥å°†è¿™ä¸ªæµ‹è¯•å¥—ä»¶é›†æˆåˆ°CI/CDæµç¨‹ä¸­ï¼š

```yaml
# .github/workflows/test.yml
name: æ»¤é•œåŠŸèƒ½æµ‹è¯•
on: [push, pull_request]
jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - uses: actions/setup-node@v2
        with:
          node-version: '16'
      - run: cd tests && npm install
      - run: cd tests && npm test
```

## ğŸ¤ è´¡çŒ®æŒ‡å—

1. æ·»åŠ æ–°æµ‹è¯•ç”¨ä¾‹æ—¶ï¼Œè¯·éµå¾ªç°æœ‰çš„å‘½åçº¦å®š
2. ç¡®ä¿æµ‹è¯•å…·æœ‰è‰¯å¥½çš„æè¿°å’Œæ–­è¨€
3. æ›´æ–°ç›¸å…³æ–‡æ¡£
4. è¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶ç¡®ä¿æ²¡æœ‰å›å½’

## ğŸ“ æ›´æ–°æ—¥å¿—

- **v1.0.0** - åˆå§‹ç‰ˆæœ¬ï¼ŒåŒ…å«å®Œæ•´çš„å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•
- è¦†ç›–æ»¤é•œé—ªçƒé—®é¢˜çš„æ‰€æœ‰ä¿®å¤ç‚¹
- æä¾›è¯¦ç»†çš„æµ‹è¯•æŠ¥å‘Šå’Œæ–‡æ¡£
